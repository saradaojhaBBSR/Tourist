<div class="container-fluid my-4">
	<div class="card shadow">
		<div class="card-header d-flex justify-content-between align-items-center bg-primary text-white" style="cursor:pointer; border-radius: .5rem .5rem 0 0;" (click)="panelOpen = !panelOpen">
			<span class="fw-bold">
				<i class="bi" [ngClass]="panelOpen ? 'bi-caret-down-fill' : 'bi-caret-right-fill'"></i>
				User Management
			</span>
			<i class="bi fs-4" [ngClass]="panelOpen ? 'bi-dash-lg' : 'bi-plus-lg'"></i>
		</div>
		<div [ngClass]="panelOpen ? 'collapse show' : 'collapse'" id="userPanel">
			<div class="card-body bg-light rounded-bottom">
			<div *ngIf="success" class="alert alert-success">{{ success }}</div>
			<div *ngIf="error" class="alert alert-danger">{{ error }}</div>
				<div *ngIf="loading" class="text-primary mb-2"><span class="spinner-border spinner-border-sm"></span> Loading...</div>
						<div class="table-responsive rounded-3 shadow-sm mt-3">
							<table class="table table-striped table-hover table-bordered align-middle mb-0 rounded-3 overflow-hidden" *ngIf="users.length" style="background: #fff;">
								<thead class="table-primary text-center align-middle">
									<tr style="vertical-align: middle;">
										<th class="text-nowrap">Role</th>
										<th class="text-nowrap">First Name</th>
										<th class="text-nowrap">Middle Name</th>
										<th class="text-nowrap">Last Name</th>
										<th class="text-nowrap">Email</th>
										<th class="text-nowrap">Phone Number</th>
										<th class="text-nowrap">Country</th>
										<th class="text-nowrap">State</th>
										<th class="text-nowrap">City</th>
										<th class="text-nowrap">Actions</th>
									</tr>
								</thead>
								<tbody>
									<tr *ngFor="let user of users" class="align-middle text-center">
												<td *ngIf="editUserId !== user.id">{{ user.role }}</td>
												<td *ngIf="editUserId === user.id">
													<select [(ngModel)]="editUserData.role" class="form-select form-select-sm" style="width:150px">
														<option value="Contributor">Contributor</option>
														<option value="Reader">Reader</option>
													</select>
												</td>

								<td *ngIf="editUserId !== user.id">{{ user.firstName }}</td>
								<td *ngIf="editUserId === user.id"><input [(ngModel)]="editUserData.firstName" class="form-control form-control-sm" /></td>

								<td *ngIf="editUserId !== user.id">{{ user.middleName }}</td>
								<td *ngIf="editUserId === user.id"><input [(ngModel)]="editUserData.middleName" class="form-control form-control-sm" /></td>

								<td *ngIf="editUserId !== user.id">{{ user.lastName }}</td>
								<td *ngIf="editUserId === user.id"><input [(ngModel)]="editUserData.lastName" class="form-control form-control-sm" /></td>

								<td *ngIf="editUserId !== user.id">{{ user.email }}</td>
								<td *ngIf="editUserId === user.id"><input [(ngModel)]="editUserData.email" class="form-control form-control-sm" /></td>

								<td *ngIf="editUserId !== user.id">{{ user.phoneNumber }}</td>
								<td *ngIf="editUserId === user.id"><input [(ngModel)]="editUserData.phoneNumber" class="form-control form-control-sm" /></td>

								<td *ngIf="editUserId !== user.id">{{ user.country }}</td>
								<td *ngIf="editUserId === user.id"><input [(ngModel)]="editUserData.country" class="form-control form-control-sm" /></td>

								<td *ngIf="editUserId !== user.id">{{ user.state }}</td>
								<td *ngIf="editUserId === user.id"><input [(ngModel)]="editUserData.state" class="form-control form-control-sm" /></td>

								<td *ngIf="editUserId !== user.id">{{ user.city }}</td>
								<td *ngIf="editUserId === user.id"><input [(ngModel)]="editUserData.city" class="form-control form-control-sm" /></td>

												<td>
													<ng-container *ngIf="editUserId !== user.id; else editActions">
														<button class="btn btn-sm btn-primary me-1" (click)="startEdit(user)" [disabled]="user.role === 'Admin'">Edit</button>
														<button class="btn btn-sm btn-danger" (click)="deleteUser(user.id)" [disabled]="user.role === 'Admin'">Delete</button>
													</ng-container>
													<ng-template #editActions>
														<button class="btn btn-sm btn-success me-1" (click)="saveEdit()">Save</button>
														<button class="btn btn-sm btn-secondary" (click)="cancelEdit()">Cancel</button>
													</ng-template>
												</td>
							</tr>
						</tbody>
					</table>
				</div>
				<div *ngIf="!users.length && !loading" class="text-muted text-center py-3">No users found.</div>
			</div>
		</div>
	</div>
</div>
